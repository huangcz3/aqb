<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>投放时段价格</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta name="author" content="zhy" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/timePrice.css">
    <script src="../js/jquery-3.1.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../H5/js/auto-size.js"></script>
    <script src="../js/paging.js"></script>
</head>
<body>
<header role="banner">

</header>
<nav role="navigation">
    <!-- Contenedor -->
    <ul id="accordion" class="accordion">
        <li>
            <div class="link"><i class="fa fa-globe"></i>设备管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./binding-reviewed.html">设备绑定审核</a></li>
                <li><a href="./unbundling.html">设备解绑</a></li>
                <li><a href="./binding.html">在线设备查询</a></li>
            </ul>
        </li>
        <li>
            <div class="link"><i class="fa fa-globe"></i>红包提现审核<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./withdrawals.html">提现审核</a></li>
            </ul>
        </li>
        <li>
            <div class="link"><i class="fa fa-globe"></i>广告管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./advertisement.html">广告内容审核</a></li>
                <li><a href="./order-list.html">广告内容列表</a></li>
                <li><a href="./advertising-settings.html">公益广告</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>修车圈管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./repair-examine.html">用户评价审核</a></li>
                <li><a href="./repair-administration.html">用户评价管理</a></li>
                <li><a href="./merchant-management.html">商家管理</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>押金管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./deposit.html">押金管理</a></li>
                <li><a href="./deposit-retreat.html">押金退还审核</a></li>
                <li><a href="./modify-money.html">押金金额设置</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>弹幕管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./barrage.html">弹幕管理</a></li>
                <li><a href="./topic.html">话题编辑</a></li>
                <li><a href="./circle.html">大小圈金额</a></li>
                <li><a href="./vip.html">VIP权限设置</a></li>
                <li><a href="./keyword.html">关键词屏蔽</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>结算与分成管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./exchange.html">兑换比例设置</a></li>
                <li><a href="./commission.html">车主分成比例设置</a></li>
                <li><a href="./referee.html">推荐人奖励</a></li>
                <li><a href="./timePrice.html#成都">时段价格设置</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>其他设置<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./integral.html">积分任务管理</a></li>
                <li><a href="./share.html">邀请分享设置</a></li>
                <li><a href="./pop-ads.html">弹窗广告设置</a></li>
                <li><a href="./insurance.html">保险</a></li>
                <li><a href="./setting.html">其他设置</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>系统设置<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./staff.html">员工权限设置</a></li>
                <li><a href="./privacy.html">隐私保护</a></li>
            </ul>
        </li>
    </ul>
</nav>
<main role="main">
    <h3 id="pageTitle">投放时段价格</h3>
    <a class="btn btn-primary add " data-toggle="modal" data-target="#addTimePrice">添加时间段</a>
    <div class="dropdown" id="cityDropDown">
        <button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">城市
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu pull-right" role="menu" aria-labelledby="dropdownMenu1">
            <li role="presentation">
                <a role="menuitem" tabindex="-1" href="#成都" data-city="成都">成都</a>
            </li>
            <li role="presentation">
                <a role="menuitem" tabindex="-1" href="#北京" data-city="北京">北京</a>
            </li>
            <li role="presentation">
                <a role="menuitem" tabindex="-1" href="#上海" data-city="上海">上海</a>
            </li>
            <li role="presentation">
                <a role="menuitem" tabindex="-1" href="#广州" data-city="广州">广州</a>
            </li>
            <li role="presentation">
                <a role="menuitem" tabindex="-1" href="#深圳" data-city="深圳">深圳</a>
            </li>
        </ul>
    </div>
    <table class="table table-striped table-bordered table-hover table-condensed">
        <thead>
            <tr>
                <th style="width: 20%">时间段</th>
                <th>价格</th>
                <th>地区</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="list">

        </tbody>
    </table>
    <!--弹窗-->
    <div class="error">
        你好，操作有误！
    </div>
</main>
<div class="modal fade" id="addTimePrice" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title" id="exampleModalLabel">添加新话题</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="startTime" class="control-label">开始时间:</label>
                        <input type="text" class="form-control" id="startTime">
                    </div>
                    <div class="form-group">
                        <label for="endTime" class="control-label">结束时间:</label>
                        <input type="text" class="form-control" id="endTime">
                    </div>
                    <div class="form-group">
                        <label for="price" class="control-label">价格:</label>
                        <input type="text" class="form-control" id="price">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="submitNewTopic">提交</button>
            </div>
        </div>
    </div>
</div>
<script>

    var para= GetQueryString();
    console.log(para);
    if(para==undefined){
        para="成都";
    }else{

    }
    getPriceList();
    appendPageTitle(para);

    window.onhashchange = hashChangeFire;

    function hashChangeFire() {
        para=location.hash;
        getPriceList();
        appendPageTitle(para);
    }
    /*
        $("#cityDropDown").on("show.bs.dropdown", function () {
            console.log("Opening dropdown..");
        });
        $("#cityDropDown").on("shown.bs.dropdown", function () {
            console.log("Dropdown opened..");
        });
    */
    function appendPageTitle(para) {
        $("#pageTitle").empty();
        $("#pageTitle").append("投放时段价格("+para+")");
    }
    function getPriceList(){
        para=GetQueryString();
        $.ajax({
            type:"get",
            url:"/aqb/api/price/queryPrice?priceCity="+para,
            datatype:"json",
            success:function(data){
                console.log(data)
                list=data.body;
                var str="";
                for(var i in list){
                    str+="<tr><td>"+list[i].priceStartString+"-"+list[i].priceEndString+"</td><td><input type=\"text\" class='timeZe' value=\""+list[i].priceJiage+"\"></td> <td>" +
                        list[i].priceCity+"</td>" +
                        "<td><input class=\"change btn btn-primary\" value=\"修改\" type=\"button\" name='"+list[i].id+"'></td> </tr>";
                }
                $("#list").empty();
                $("#list").append(str);
            }
        })
    }

    function GetQueryString() {
        var r = window.location.toString().split("#");
        return  r[1];
    }
    $(document).on("click",".change",function () {
        var id=$(this).attr("name");
        var priceJiage=$(this).parent().prev().prev().find("input").val();
        changes(priceJiage,id)
    })
    function changes(priceJiages,ids) {
        var searchDate={
            priceJiage:priceJiages,
            id:ids
        }
        console.log(JSON.stringify(searchDate));
            $.ajax({
                type: "post",//读取方式
                url: "../api/price/updatePrice",//通过url去读取json/数据
                contentType: "application/json",
                data: JSON.stringify(searchDate),//是否向后台传参数
                success: function (date) {//result变量去接收json数据
                    if (date.status == false) {
                        $(".error").text(date.message);
                        $(".error").fadeToggle(300,function () {
                            $(".error").fadeToggle(1000)
                            window.location.reload();
                        })

                    } else {
                        $(".error").text(date.message);
                        $(".error").fadeToggle(300,function () {
                            $(".error").fadeToggle(3000)
                        })
                    }
                },//success
            });
    }
</script>

</body>
</html>