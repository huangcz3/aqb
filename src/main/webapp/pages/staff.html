<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>权限管理</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <Link rel="stylesheet" href="../css/bootstrap-switch.min.css" >
    <script src="../js/bootstrap-switch.min.js"></script>
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <!--<script src="../js/base.js"></script>-->
    <script src="../H5/js/auto-size.js"></script>
    <script src="../js/paging.js"></script>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/staff.css">
</head>
<body>
<header role="banner">

</header>
<nav role="navigation">
    <!-- Contenedor -->
    <ul id="accordion" class="accordion">
        <li>
            <div class="link"><i class="fa fa-globe"></i>设备管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./binding-reviewed.html">设备绑定审核</a></li>
                <li><a href="./unbundling.html">设备解绑</a></li>
                <li><a href="./binding.html">在线设备查询</a></li>
            </ul>
        </li>
        <li>
            <div class="link"><i class="fa fa-globe"></i>红包提现审核<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./withdrawals.html">提现审核</a></li>
            </ul>
        </li>
        <li>
            <div class="link"><i class="fa fa-globe"></i>广告管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./advertisement.html">广告内容审核</a></li>
                <li><a href="./order-list.html">广告内容列表</a></li>
                <li><a href="./advertising-settings.html">公益广告</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>修车圈管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./repair-examine.html">用户评价审核</a></li>
                <li><a href="./repair-administration.html">用户评价管理</a></li>
                <li><a href="./merchant-management.html">商家管理</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>押金管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./deposit.html">押金管理</a></li>
                <li><a href="./deposit-retreat.html">押金退还审核</a></li>
                <li><a href="./modify-money.html">押金金额设置</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>弹幕管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./barrage.html">弹幕管理</a></li>
                <li><a href="./topic.html">话题编辑</a></li>
                <li><a href="./circle.html">大小圈金额</a></li>
                <li><a href="./vip.html">VIP权限设置</a></li>
                <li><a href="./keyword.html">关键词屏蔽</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>结算与分成管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./exchange.html">兑换比例设置</a></li>
                <li><a href="./commission.html">车主分成比例设置</a></li>
                <li><a href="./referee.html">推荐人奖励</a></li>
                <li><a href="./timePrice.html#成都">时段价格设置</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>其他设置<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./integral.html">积分任务管理</a></li>
                <li><a href="./share.html">邀请分享设置</a></li>
                <li><a href="./pop-ads.html">弹窗广告设置</a></li>
                <li><a href="./insurance.html">保险</a></li>
                <li><a href="./setting.html">其他设置</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>系统设置<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./staff.html">员工权限设置</a></li>
                <li><a href="./privacy.html">隐私保护</a></li>
            </ul>
        </li>
    </ul>
</nav>
<main role="main">
    <h3>员工列表</h3>
    <a class="btn btn-primary add"  data-toggle="modal" data-target="#addStaff">添加员工</a>
    <table class="table table-striped table-bordered table-hover table-condensed">
        <thead>
        <tr>
            <th>姓名</th>
            <th>工号</th>
            <th>职位名称</th>
            <th></th>
            <th></th>
        </tr>
        </thead>
        <tbody id="staffList">
        </tbody>
    </table>
</main>
<div class="modal fade" id="addStaff" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title" id="exampleModalLabel">添加新员工</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="newUserName" class="control-label">用户名:</label>
                        <input type="text" class="form-control" id="newUserName">
                    </div>
                    <div class="form-group">
                        <label for="newStaffPassword" class="control-label">密码:</label>
                        <input type="text" class="form-control" id="newStaffPassword">
                    </div>
                    <div class="form-group">
                        <label for="newStaffNum" class="control-label">工号:</label>
                        <input type="text" class="form-control" id="newStaffNum">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="submitNewStaff">提交</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editStaffModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div id="authList" class="panel panel-primary">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<script>
    var list;
    getStaffList();
    function getStaffList(){
        $.ajax({
            url:"/aqb/api/admin/queryAdmin",
            type:"get",
            datatype:"json",
            success:function(data){
                list=data.body;
                var str="";
                for(var no in list){
                    var staff=list[no];
                    if(staff.status==1){
                        //delete函数的参数传递要注意
                        str=str+"<tr><td>"+staff.adminName+"</td><td>"+staff.adminNumber+"</td><td>普通员工</td>" +
                            "<td><input class='change btn btn-success' value='修改权限' type='button'   data-toggle=\"modal\" data-target=\"#editStaffModal\"  data-whatever='"+staff.id+"'  ></td> " +
                            "<td><input class='delete btn btn-danger' value='删除' type='button' onclick='deleteStaff(\"" +staff.id+"\");'/></td> </tr>";
                    }else{
                        str=str+"<tr><td>"+staff.adminName+"</td><td>"+staff.adminNumber+"</td><td>系统管理员</td>" +
                            "<td><input class='change btn btn-success' value='修改权限' type='button '    data-toggle=\"modal\" data-target=\"#editStaffModal\"></td><td><input class='delete btn btn-danger' value='删除' type='button' onclick='deleteStaff(\"" +staff.id+"\");'/></td> ";
                    }


                }
                $("#staffList").empty();
                $("#staffList").append(str);
            }
        })
    }
    $('#submitNewStaff').on('click', function (event) {
        var staff={
            adminName:$("#newUserName").val(),
            adminPass:$("#newStaffPassword").val(),
            adminNumber:$("#newStaffNum").val()
        }
        $.ajax(
            {
                url:"/aqb/api/admin/addAdmin",
                type:"post",
                contentType:"applycation/json",
                dataType:"json",
                data:JSON.stringify(staff),
                success:function (data) {
                    //0--成功, 10--验证码错误, 7 --客户不存在,9-- 密码不正确
                    alert(data.message);
                    getStaffList();
                    $('#addStaff').modal('hide');
                    $("#newUserName").val("");
                    $("#newStaffPassword").val("");
                    $("#newStaffNum").val("");
                }
            }
        )
    })
    function deleteStaff(id) {
        var staff={
            id:id
        }
        $.ajax(
            {
                url:"/aqb/api/admin/deleteAdmin",
                type:"post",
                contentType:"applycation/json",
                dataType:"json",
                data:JSON.stringify(staff),
                success:function (data) {
                    //0--成功, 10--验证码错误, 7 --客户不存在,9-- 密码不正确
                    alert(data.message);
                    getStaffList();
                }
            }
        )
    }
    function change(e) {
        location.href="./changeStaff.html?id="+e;
    }

    $('#editStaffModal').on('show.bs.modal', function (event) {
        //Switch组件必须初始化
        var button = $(event.relatedTarget); // 触发事件的按钮
        var id = button.data('whatever') ;// 解析出data-whatever内容
        console.log(id);
        var staff=getInList(id)
        var str="<div class=\"panel-heading\">" +staff.adminName+
            "</div> " +
            "<table class=\"table table-striped table-bordered table-hover table-condensed\"> <tbody>";
        var id1=id+"_"+"authority1_"+staff.authority1;
        var id2=id+"_"+"authority2_"+staff.authority2;
        var id3=id+"_"+"authority3_"+staff.authority3;
        var id4=id+"_"+"authority4_"+staff.authority4;
        var id5=id+"_"+"authority5_"+staff.authority5;
        var id6=id+"_"+"authority6_"+staff.authority6;
        if(staff.authority1){
            str+="<tr><td>审核弹幕</td><td class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\" id='"+id1+"' checked></td> </tr> ";
        }else {
            str+="<tr><td>审核弹幕</td><td class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\" id='"+id1+"'   ></td> </tr> " ;
        }
        if(staff.authority2){
            str+="<tr><td>广告内容审核</td><td  id='"+id2+"'  class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\" checked></td> </tr> " ;
        }else{
            str+="<tr><td>广告内容审核</td><td  id='"+id2+"'  class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\"></td> </tr> " ;
        }
        if(staff.authority3){
            str+="<tr><td>兑换比例设置</td><td  id='"+id3+"'  class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\" checked></td> </tr> ";
        }else{
            str+="<tr><td>兑换比例设置</td><td id='"+id3+"'    class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\"></td> </tr> " ;
        }
        if(staff.authority4){
            str+="<tr><td>话题编辑</td><td  id='"+id4+"'  class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\" checked></td> </tr> ";
        }else {
            str+="<tr><td>话题编辑</td><td  id='"+id4+"'  class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\"></td> </tr> ";
        }
        if(staff.authority5){
            str+="<tr><td>兑换比例设置</td><td  id='"+id5+"'  class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\" checked></td> </tr> ";
        }else{
            str+="<tr><td>兑换比例设置</td><td  id='"+id5+"'  class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\"></td> </tr> " ;
        }
        if(staff.authority6){
            str+="<tr><td>VIP权限设置</td><td  id='"+id6+"'  class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\" checked></td> </tr> " +
                "</tbody> </table>";
        }else{
            str+="<tr><td>VIP权限设置</td><td  id='"+id6+"' class=\"myswitch\" ><input type=\"checkbox\" name=\"my-checkbox\"></td> </tr> " +
                "</tbody> </table>";
        }

        $("#authList").empty();
        $("#authList").append(str);
        var idList=[];
        idList.push("#"+id1);
        idList.push("#"+id2);
        idList.push("#"+id3);
        idList.push("#"+id4);
        idList.push("#"+id5);
        idList.push("#"+id6);
        for(var idNum in idList){

            $(idList[idNum]).on({
                /*
                'init.bootstrapSwitch': function() {
                    $(idList[idNum]).bootstrapSwitch("state", state);// 初始化状态

                },*/
                'switchChange.bootstrapSwitch': function(event, state) {
                    // 处理
                    //alert("aaa");
                    var group=$(this).attr("id").split("_");
                    var id=group[0].substring(0,group[0].length);
                    var type=group[1];
                    var val=group[2];
                    if(val==1){
                        val=0;
                    }else{
                        val=1;
                    }
                    var admin={
                        id:id
                    }
                    admin[type]=val;
                    $.ajax(
                        {
                            url:"/aqb/api/admin/updateadmin",
                            type:"post",
                            contentType:"applycation/json",
                            dataType:"json",
                            data:JSON.stringify(admin),
                            success:function (data) {
                                //0--成功, 10--验证码错误, 7 --客户不存在,9-- 密码不正确

                                alert(data.message);
                                getStaffList();
                            }
                        }
                    )
                }
            });
        }

        $.fn.bootstrapSwitch.defaults.onColor = 'success';
        $.fn.bootstrapSwitch.defaults.offColor = 'danger';
        $("[name='my-checkbox']").bootstrapSwitch();
    })

    function getInList(id) {
        for(var i in list){
            if(list[i].id==id){
                return list[i];
            }
        }
        return null;
    }
</script>
</body>
</html>