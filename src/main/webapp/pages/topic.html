<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>话题编辑</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta name="author" content="zhy" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap-switch.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/topic.css">
</head>
<body>
<header role="banner">

</header>
<nav role="navigation">
    <!-- Contenedor -->
    <ul id="accordion" class="accordion">
        <li>
            <div class="link"><i class="fa fa-globe"></i>设备管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./binding-reviewed.html">设备绑定审核</a></li>
                <li><a href="./unbundling.html">设备解绑</a></li>
                <li><a href="./binding.html">在线设备查询</a></li>
            </ul>
        </li>
        <li>
            <div class="link"><i class="fa fa-globe"></i>红包提现审核<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./withdrawals.html">提现审核</a></li>
            </ul>
        </li>
        <li>
            <div class="link"><i class="fa fa-globe"></i>广告管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./advertisement.html">广告内容审核</a></li>
                <li><a href="./order-list.html">广告内容列表</a></li>
                <li><a href="./advertising-settings.html">公益广告</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>修车圈管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./repair-examine.html">用户评价审核</a></li>
                <li><a href="./repair-administration.html">用户评价管理</a></li>
                <li><a href="./merchant-management.html">商家管理</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>押金管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./deposit.html">押金管理</a></li>
                <li><a href="./deposit-retreat.html">押金退还审核</a></li>
                <li><a href="./modify-money.html">押金金额设置</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>弹幕管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./barrage.html">弹幕管理</a></li>
                <li><a href="./topic.html">话题编辑</a></li>
                <li><a href="./circle.html">大小圈金额</a></li>
                <li><a href="./vip.html">VIP权限设置</a></li>
                <li><a href="./keyword.html">关键词屏蔽</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>结算与分成管理<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./exchange.html">兑换比例设置</a></li>
                <li><a href="./commission.html">车主分成比例设置</a></li>
                <li><a href="./referee.html">推荐人奖励</a></li>
                <li><a href="./timePrice.html#成都">时段价格设置</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>其他设置<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./integral.html">积分任务管理</a></li>
                <li><a href="./share.html">邀请分享设置</a></li>
                <li><a href="./pop-ads.html">弹窗广告设置</a></li>
                <li><a href="./insurance.html">保险</a></li>
                <li><a href="./setting.html">其他设置</a></li>
            </ul>
        </li>
        <li><div class="link"><i class="fa fa-globe"></i>系统设置<i class="fa fa-chevron-down"></i></div>
            <ul class="submenu">
                <li><a href="./staff.html">员工权限设置</a></li>
                <li><a href="./privacy.html">隐私保护</a></li>
            </ul>
        </li>
    </ul>
</nav>
<main role="main">
    <h3>话题编辑</h3>
    <a class="btn btn-primary add " data-toggle="modal" data-target="#addTopic">添加话题</a>
    <!--<div class="dropdown">-->
        <!--<button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">排序方式-->
            <!--<span class="caret"></span>-->
        <!--</button>-->
        <!--<ul class="dropdown-menu pull-right" role="menu" aria-labelledby="dropdownMenu1">-->
            <!--<li role="presentation">-->
                <!--<a role="menuitem" tabindex="-1" href="#">按时间排序</a>-->
            <!--</li>-->
            <!--<li role="presentation">-->
                <!--<a role="menuitem" tabindex="-1" href="#">按热度排序</a>-->
            <!--</li>-->
        <!--</ul>-->
    <!--</div>-->
    <table class="table table-striped table-bordered table-hover table-condensed">
        <thead>
            <tr>
                <th style="width: 6%;">序号</th>
                <th style="width: 8%;">话题标题</th>
                <th style="width: 70%;">话题内容</th>
                <th colspan="2">操作</th>
            </tr>
        </thead>
        <tbody id="topicList">

        </tbody>
    </table>
    <!--弹窗-->
    <div class="error">
        你好，操作有误！
    </div>
</main>


<div class="modal fade" id="addTopic" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title" id="exampleModalLabel-add">添加新话题</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="newTopicTitle" class="control-label">话题标题:</label>
                        <input type="text" class="form-control" id="newTopicTitle">
                    </div>
                    <div class="form-group">
                        <label for="newTopicContent" class="control-label">话题内容:</label>
                        <input type="text" class="form-control" id="newTopicContent">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="submitNewTopic">提交</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editTopicModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
                <h4 class="modal-title" id="exampleModalLabel">修改新话题</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="oldTopicID" class="control-label">ID:</label>
                        <input type="text" class="form-control" id="oldTopicID" disabled>
                    </div>
                    <div class="form-group">
                        <label for="oldTopicTitle" class="control-label">话题标题:</label>
                        <input type="text" class="form-control" id="oldTopicTitle">
                    </div>
                    <div class="form-group">
                        <label for="oldTopicContent" class="control-label">话题内容:</label>
                        <input type="text" class="form-control" id="oldTopicContent">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" id="submitOldTopic" onclick="editTopic()">提交</button>
            </div>
        </div>
    </div>
</div>
<script src="../js/jquery-3.1.1.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/bootstrap-switch.min.js"></script>
<script src="../H5/js/auto-size.js"></script>
<script src="../js/paging.js"></script>
<script>
    var list;
    getTopicList();
    $('#editTopicModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // 触发事件的按钮
        var recipient = button.data('whatever') ;// 解析出data-whatever内容
        var recipient1 = button.data('whatever2') ;// 解析出data-whatever内容
        var recipient2 = button.data('whatever3') ;// 解析出data-whatever内容
        var modal = $(this);
        modal.find('.modal-body #oldTopicID').val(recipient);
        modal.find('.modal-body #oldTopicTitle').val(recipient1);
        modal.find('.modal-body #oldTopicContent').val(recipient2);
    })
    $('#submitNewTopic').on('click', function (event) {
        var topic={
            id:$("#newTopicID").val(),
            topicTitle:$("#newTopicTitle").val(),
            topicContent:$("#newTopicContent").val()
        }
        $.ajax(
            {
                url:"../api/topic/addTopic",
                type:"post",
                contentType:"applycation/json",
                dataType:"json",
                data:JSON.stringify(topic),
                success:function (data) {
                    //0--成功, 10--验证码错误, 7 --客户不存在,9-- 密码不正确
                    $(".error").text(data.message).fadeToggle(300,function () {
                        $(".error").fadeToggle(3000)
                    })
                    getTopicList();
                    $('#addTopic').modal('hide');
                    $("#newTopicID").val("");
                    $("#newTopicTitle").val("");
                    $("#newTopicContent").val("");
                }
            }
        )
    })
    function getTopicList(){
        $.ajax({
            url:"/aqb/api/topic/queryTopic",
            type:"get",
            datatype:"json",
            success:function(data){
                list=data.body;
                console.log(data)
                var str="";
                for(var no in list){
                    var topic=list[no];
                    str+="<tr><td>"+no+"</td><td>"+topic.topicTitle+"</td><td>"+topic.topicContent+" </td>" +
                        "<td><input class='change btn btn-success' value='修改' type='button'  data-toggle='modal' data-target='#editTopicModal' data-whatever='"+topic.id+"' " +
                            "data-whatever2='"+topic.topicTitle+"' data-whatever3='"+topic.topicContent+"'></td> " +
                        "<td><input class='delete btn btn-danger' value='删除' type='button' onclick='deleteTopic(\""+topic.id+"\")'></td> </tr>";
                }
                $("#topicList").empty();
                $("#topicList").append(str);
            }
        })
    };
    function editTopic(){
        var topic={
            id:$("#oldTopicID").val(),
            topicTitle:$("#oldTopicTitle").val(),
            topicContent:$("#oldTopicContent").val()
        };
        $.ajax(
            {
                url:"/aqb/api/topic/updateTopic",
                type:"post",
                contentType:"applycation/json",
                dataType:"json",
                data:JSON.stringify(topic),
                success:function (data) {
                    //0--成功, 10--验证码错误, 7 --客户不存在,9-- 密码不正确
                    $(".error").text(data.message).fadeToggle(300,function () {
                        $(".error").fadeToggle(3000)
                    })
                    getTopicList();
                    $('#editTopicModal').modal('hide');
                    $("#oldTopicID").val("");
                    $("#oldTopicTitle").val("");
                    $("#oldTopicContent").val("");
                }
            }
        )
    }
    function deleteTopic(id){
//        var topic=getTopicInList(id);
        var topic={
            id:id
        };
        console.log(topic)
        console.log(id)
        $.ajax(
            {
                url:"/aqb/api/topic/deleteTopic",
                type:"post",
                contentType:"applycation/json",
                dataType:"json",
                data:JSON.stringify(topic),
                success:function (data) {
                    //0--成功, 10--验证码错误, 7 --客户不存在,9-- 密码不正确
                    $(".error").text(data.message).fadeToggle(300,function () {
                        $(".error").fadeToggle(3000)
                    })
                    getTopicList();
                }
            }
        )
    }
    function getTopicInList(id){
        for(var i in list){
            if(list[i].id==id){
                return list[i];
            }
        }
    }

</script>
</body>
</html>